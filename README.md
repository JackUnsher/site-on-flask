# Flask Application

## О проекте
Это веб-приложение, разработанное с использованием Flask, реализующее шаблон MVC (Model-View-Controller), с системами аутентификации и авторизации, интеграцией с базой данных и адаптивным пользовательским интерфейсом.

## Технический стек

### Backend
- **Flask 2.3.3** - веб-фреймворк для Python
- **SQLAlchemy**: ORM для работы с базой данных
- **Flask-Migrate**: Миграции базы данных
- **Flask-Login**: Управление сессиями пользователей
- **Flask-WTF**: Работа с формами и защита от CSRF-атак
- **Flask-Caching**: Кэширование данных

### База данных
- **SQLite**: локальная реляционная БД для разработки

### Frontend
- **Bootstrap 5**: Адаптивный UI фреймворк
- **JavaScript**: Интерактивность на стороне клиента
- **Chart.js**: Визуализация данных
- **AJAX**: Асинхронные запросы к серверу
- **Jinja2**: Шаблонизатор

### Безопасность
- **CSRF Protection**: Защита от Cross-Site Request Forgery
- **Password Hashing**: Безопасное хранение паролей
- **Role-Based Access Control**: Контроль доступа на основе ролей

### Важные примечания по версиям
Проект требует следующих версий основных зависимостей:
- Flask 2.3.3
- Werkzeug 2.3.7

Использование более новых версий может привести к проблемам совместимости при запуске приложения.

## Особенности
- **MVC архитектура**: Чёткое разделение данных, представления и бизнес-логики
- **Role-Based Access Control**: Разграничение доступа на основе ролей
- **ORM**: Объектно-реляционное отображение для работы с базой данных
- **Data Caching**: Кэширование для повышения производительности
- **CSRF Protection**: Защита от атак с подделкой запросов

## Установка

### Предварительные требования
- Python 3.6+
- pip (менеджер пакетов Python)
- Git

### Шаги установки
1. Клонирование репозитория:
```bash
git clone https://github.com/your-username/your-repo.git
cd your-repo
```

2. Создание виртуального окружения:
```bash
python -m venv venv
```

3. Активация виртуального окружения:
   - Windows:
   ```bash
   venv\Scripts\activate
   ```
   - macOS/Linux:
   ```bash
   source venv/bin/activate
   ```

4. Установка зависимостей:
```bash
pip install -r requirements.txt
```

5. Настройка переменных окружения:
   - Создайте файл `.env` в корне проекта:
   ```
   FLASK_APP=app.py
   FLASK_ENV=development
   SECRET_KEY=your-secret-key
   ```

## Запуск приложения
1. Применение миграций:
```bash
flask db upgrade
```

2. Запуск сервера Flask:
```bash
flask run
```

3. Приложение будет доступно по адресу: http://localhost:5000

## Структура проекта
```
/
├── app/                    # Основной пакет приложения
│   ├── controllers/        # Контроллеры (обработчики запросов)
│   ├── models/             # Модели данных (SQLAlchemy)
│   ├── static/             # Статические файлы (CSS, JS, изображения)
│   ├── templates/          # HTML-шаблоны (Jinja2)
│   └── __init__.py         # Инициализация приложения
├── tests/                  # Тесты
│   ├── conftest.py         # Фикстуры pytest
│   ├── test_auth.py        # Тесты аутентификации
│   ├── test_models.py      # Тесты моделей данных
│   └── test_routes.py      # Тесты маршрутов
├── migrations/             # Миграции базы данных
├── instance/               # Директория для данных (SQLite БД)
├── .env                    # Переменные окружения
├── app.py                  # Точка входа в приложение
├── config.py               # Конфигурация приложения
├── requirements.txt        # Зависимости проекта
└── README.md               # Документация проекта
```

## Разработка
Если вы хотите внести свой вклад в проект:
1. Форкните репозиторий
2. Создайте ветку для новой функциональности 
3. Внесите изменения и отправьте pull request

## Деплой на Amvera Cloud

### Автоматическое развертывание
Проект настроен для автоматического развертывания на [Amvera Cloud](https://cloud.amvera.ru/) с использованием вебхука.

### Особенности деплоя
- **SQLite База данных**: Данные хранятся в persistent директории `instance`
- **Gunicorn**: WSGI-сервер для запуска приложения в продакшен
- **Автоматические миграции**: База данных автоматически обновляется при деплое
- **Версии зависимостей**: Проект требует Flask 2.3.3 и Werkzeug 2.3.7 для стабильной работы

### Настройки
Для развертывания используется файл `amvera.yml`, который определяет:
- Версию Python
- Команду запуска
- Переменные окружения
- Постоянное хранилище для базы данных
- Хуки после деплоя

### Устранение проблем при деплое
Если возникают проблемы с деплоем:
1. Убедитесь, что используются совместимые версии Flask (2.3.3) и Werkzeug (2.3.7)
2. Проверьте, что директория для базы данных `/app/instance` создается при деплое
3. Просмотрите логи в панели управления Amvera для выявления конкретных ошибок

### Подробная документация
Полная информация о развертывании приложения на Amvera доступна в [AMVERA_DEPLOYMENT.md](AMVERA_DEPLOYMENT.md).

## Лицензия
Проект распространяется под лицензией MIT. 