# Cursor MCP для интеграции с Figma

Плагин для автоматического извлечения и импорта дизайна из Figma в проект через Cursor.

## Установка

### 1. Установка плагина Figma

1. Откройте Figma и перейдите в меню **Plugins > Development > New Plugin**
2. Выберите "Link existing plugin"
3. Укажите путь к файлу `mcp/figma/manifest.json` в вашем проекте
4. Плагин будет доступен в меню **Plugins > Development > Cursor MCP**

### 2. Настройка WebSocket сервера

WebSocket сервер используется для коммуникации между Figma и Cursor.

#### Автоматический запуск (рекомендуется)

Просто запустите скрипт `start_server.bat` в директории проекта. Скрипт автоматически:
1. Проверит наличие Node.js
2. Установит необходимые зависимости
3. Запустит WebSocket сервер на `ws://localhost:8080`

#### Ручной запуск

```bash
# Установка зависимостей
npm install ws

# Запуск сервера
node mcp/figma/socket.js
```

Сервер запустится по умолчанию на `ws://localhost:8080`.

### 3. Настройка Python клиента

Python клиент обрабатывает сообщения от WebSocket сервера и сохраняет экспортированные изображения.

#### Автоматический запуск (рекомендуется)

Запустите скрипт `start_client.bat` в директории проекта. Скрипт автоматически:
1. Проверит наличие Python
2. Установит необходимый модуль websocket-client
3. Запустит Python клиент

#### Ручной запуск

```bash
# Установка зависимостей
py -m pip install websocket-client --user

# Запуск клиента
py mcp/figma/cursor_handler.py
```

### 4. Настройка MCP в Cursor

Скопируйте файл `mcp/figma/mcp_config.json` в директорию `~/.cursor/mcp.json` или добавьте его содержимое в существующий файл.

## Использование

### 1. Запуск компонентов системы

1. Запустите WebSocket сервер с помощью `start_server.bat`
2. Запустите Python клиент с помощью `start_client.bat`
3. Откройте Figma и запустите плагин Cursor MCP

### 2. Подключение к WebSocket серверу

1. В плагине Figma перейдите во вкладку "Настройки"
2. Введите URL сервера (`ws://localhost:8080`) и имя канала (`cursor_mcp`)
3. Нажмите кнопку "Подключиться"
4. После успешного подключения вы увидите сообщение "Подключено к серверу"

### 3. Автоматический поиск и экспорт изображений

1. Перейдите во вкладку "Автопоиск"
2. Выберите формат (PNG, JPG, SVG) и масштаб экспорта
3. Нажмите "Найти изображения" для сканирования текущей страницы
4. После завершения сканирования нажмите "Экспортировать все"
5. Прогресс экспорта будет отображаться в интерфейсе
6. Экспортированные изображения будут сохранены в директории `app/static/assets`

### 4. Экспорт выбранных элементов

1. Выберите элементы в Figma, которые хотите экспортировать
2. Перейдите во вкладку "Экспорт"
3. Выберите формат и масштаб
4. Нажмите "Экспортировать"

## Интеграция с CSS

### Соответствие CSS-переменных

Плагин автоматически сопоставляет CSS-переменные из Figma с переменными в проекте согласно настройкам в `mcp_config.json`. Основные соответствия:

| Переменная в Figma | CSS-переменная в проекте |
|--------------------|--------------------|
| primary            | --color-primary    |
| secondary          | --color-secondary  |
| accent-gold        | --color-accent-gold|
| text-primary       | --color-text-primary|
| text-secondary     | --color-text-secondary|
| background         | --color-background |

### Проверка CSS-переменных

Для обеспечения согласованности между Figma и вашим проектом:

1. Убедитесь, что в файле `app/static/css/variables.css` определены все переменные, указанные в `mcp_config.json`
2. Проверьте, что CSS-классы компонентов в проекте соответствуют маппингу в `mcp_config.json`
3. При изменении дизайна в Figma синхронизируйте CSS-переменные в проекте

## Особенности

- Автоматический поиск изображений на странице
- Извлечение информации о выделенных элементах
- Массовый экспорт элементов дизайна
- Поддержка различных форматов экспорта (PNG, JPG, SVG)
- WebSocket интеграция для передачи данных в Cursor
- Автоматическое сохранение изображений в директории assets
- Синхронизация CSS-переменных между Figma и проектом
- Python клиент для обработки экспортированных изображений

## Структура проекта

```
mcp/figma/
├── manifest.json          # Манифест плагина Figma
├── code.js                # Основной код плагина Figma
├── ui.html                # Интерфейс плагина
├── socket.js              # WebSocket сервер
├── cursor_handler.py      # Python клиент
├── mcp_config.json        # Конфигурация MCP для Cursor
├── start_server.bat       # Скрипт запуска WebSocket сервера
├── start_client.bat       # Скрипт запуска Python клиента
└── README.md              # Инструкция по использованию
```

## Решение проблем

### "Manifest error: Invalid capability specified"

Убедитесь, что в `manifest.json` поле `capabilities` не содержит `networkAccess` (это должен быть отдельный объект).

### "WebSocket connection failed"

- Проверьте, запущен ли WebSocket сервер (`start_server.bat`)
- Убедитесь, что порт 8080 не занят другим приложением
- Проверьте настройки брандмауэра
- Убедитесь, что URL в плагине соответствует запущенному серверу (ws://localhost:8080)
- В случае постоянных ошибок попробуйте изменить порт в `socket.js` и в настройках плагина

### "Изображения не экспортируются"

- Убедитесь, что у выбранных элементов есть изображения
- Проверьте, что WebSocket соединение установлено
- Убедитесь, что Python клиент запущен (`start_client.bat`)
- Проверьте права доступа к папке assets
- Проверьте наличие пути `app/static/assets` - создайте директорию, если она отсутствует

### "Ошибки CSS при импорте стилей из Figma"

- Проверьте соответствие CSS-переменных в `variables.css` и `mcp_config.json`
- Убедитесь, что в проекте используются правильные CSS-селекторы, указанные в `mcp_config.json`
- Обновите `mcp_config.json` при добавлении новых переменных или компонентов
- Если стили не применяются, проверьте правильность селекторов в HTML-шаблонах

### "Не устанавливаются зависимости"

- Убедитесь, что у вас установлен Node.js и Python
- Проверьте наличие доступа в интернет для установки пакетов
- Попробуйте установить зависимости вручную с параметром `--verbose` для получения подробной информации об ошибках 